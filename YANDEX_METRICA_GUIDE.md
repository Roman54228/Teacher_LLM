# Яндекс Метрика - Руководство по интеграции

## Интеграция завершена ✅

Яндекс Метрика успешно интегрирована в Telegram Mini App со следующими возможностями:

### 1. Счетчик Метрики
- **ID счетчика**: 103395184 (настроен и активен)
- **Специальные настройки для Telegram Mini App**:
  - `clickmap: true` - карта кликов для анализа поведения пользователей
  - `trackLinks: true` - отслеживание переходов по ссылкам
  - `accurateTrackBounce: true` - точный показатель отказов
  - `webvisor: true` ✅ **ВЕБВИЗОР АКТИВЕН** - записи сессий пользователей
  - `trackHash: true` - отслеживание хэш-навигации для SPA
  - Специальные параметры: `telegram_mini_app: true`, версия приложения

### 2. Отслеживаемые события

#### Тестирование и викторины
- `test_start` - начало теста (с категорией)
- `test_resume` - продолжение прерванного теста  
- `test_complete` - завершение теста
- `question_answered` - ответ на вопрос
- `answer_correct` - правильный ответ
- `answer_incorrect` - неправильный ответ

#### ИИ взаимодействие
- `ai_chat_start` - открытие AI чата
- `ai_chat_message` - отправка сообщения в AI
- `hint_requested` - запрос подсказки

#### Навигация
- `navigation` - переход между разделами
- `app_init` - инициализация приложения

### 3. Отслеживание страниц
Автоматически отслеживается посещение всех разделов:
- Главная
- Тесты и категории
- Скрининговый тест
- Аналитика
- Профиль
- База знаний

### 4. Как настроить реальный счетчик

1. **Создайте счетчик в Яндекс Метрике**:
   - Перейдите на https://metrica.yandex.ru/
   - Создайте новый счетчик
   - Укажите URL вашего Telegram Mini App

2. **ID счетчика настроен**:
   - Используется реальный счетчик: `103395184`
   - Код обновлен во всех местах в `templates/index.html`

3. **Настройте цели в интерфейсе Яндекс Метрики** (https://metrica.yandex.ru/):
   
   **Основные цели для создания:**
   
   • **"Завершение теста"** 
     - Тип: JavaScript событие  
     - Идентификатор: `test_complete`
     - Описание: Пользователь завершил любой тест
   
   • **"Использование AI помощника"**
     - Тип: JavaScript событие
     - Идентификатор: `ai_chat_start`
     - Описание: Пользователь открыл AI чат для помощи
   
   • **"Прохождение скринингового теста"**
     - Тип: Составная цель
     - Условия: `test_start` (category=screening) → `test_complete` (category=screening)
     - Описание: Полное прохождение скринингового теста
   
   • **"Активный пользователь"**
     - Тип: JavaScript событие
     - Идентификатор: `question_answered`
     - Условие: 5+ событий за сессию
     - Описание: Ответил на 5+ вопросов
     
   • **"Запрос подсказки"**
     - Тип: JavaScript событие
     - Идентификатор: `hint_requested`
     - Описание: Использование системы подсказок

### 5. Полезные отчеты в Яндекс Метрике

После настройки вы сможете отслеживать:
- **Конверсии**: сколько пользователей завершают тесты
- **Поведение**: какие категории популярнее  
- **Вовлеченность**: использование AI помощника и подсказок
- **Карта кликов**: где пользователи кликают чаще всего
- **Вебвизор** ✅: записи сессий пользователей в реальном времени
  - Просмотр движений мыши и кликов
  - Скроллинг и взаимодействие с интерфейсом
  - Время на каждом экране
  - Проблемные места в UX

### 6. Преимущества Вебвизора для Mini App
- **Анализ UX**: видите, как пользователи взаимодействуют с интерфейсом
- **Поиск проблем**: находите места, где пользователи испытывают затруднения
- **Оптимизация**: улучшаете кнопки, формы и навигацию на основе реальных данных
- **Mobile-first**: идеально подходит для анализа мобильного опыта в Telegram

### 6. Данные для анализа

Все события содержат полезную информацию:
- ID пользователя Telegram (где доступно)
- Категория теста
- Номер вопроса
- Статус авторизации
- Результаты тестов

### 7. Совместимость с Telegram

Код полностью совместим с Telegram Mini App:
- Не блокирует загрузку приложения
- Работает в веб-версии и мобильных клиентах
- Передает данные пользователя Telegram для сегментации

## Следующие шаги ✅ ГОТОВО

1. ✅ **Реальный счетчик настроен** - ID: 103395184
2. ⏳ **Создайте цели в Яндекс Метрике** - см. список рекомендуемых целей выше  
3. ⏳ **Настройте уведомления** о важных событиях в интерфейсе Яндекс Метрики
4. ⏳ **Анализируйте данные** - через 24-48 часов появятся первые отчеты

## Проверка работоспособности

После запуска приложения проверьте в консоли браузера сообщения:
- `Yandex.Metrika event: app_init` - инициализация приложения
- `Yandex.Metrika event: navigation` - переходы между разделами  
- `Yandex.Metrika event: test_start` - начало тестов
- `Yandex.Metrika page view: Главная` - просмотры страниц

В интерфейсе Яндекс Метрики данные появятся в течение 15-30 минут.

## Доступ к Вебвизору

1. Зайдите в интерфейс Яндекс Метрики: https://metrica.yandex.ru/
2. Выберите счетчик 103395184
3. Перейдите в раздел **"Поведение" → "Вебвизор"**
4. Через несколько минут после первого использования приложения появятся записи сессий
5. Кликните на любую запись для просмотра взаимодействия пользователя

**Важно**: Вебвизор записывает все действия пользователей, включая клики, скроллинг и ввод текста (пароли автоматически скрываются).