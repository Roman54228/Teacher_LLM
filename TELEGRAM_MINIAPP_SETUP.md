# Настройка Telegram Mini App для получения данных пользователя

## Проблема
Telegram WebApp не передает данные пользователя (`initDataUnsafe` пустой) в тестовой среде Replit.

## Решение: Правильная настройка Telegram Bot

### 1. Создание бота и Mini App

1. **Создайте бота через @BotFather:**
   ```
   /newbot
   MyInterviewPrepBot
   interview_prep_bot
   ```

2. **Получите токен бота** и сохраните его

3. **Настройте Mini App через @BotFather:**
   ```
   /newapp
   @interview_prep_bot
   Interview Prep
   Подготовка к техническим собеседованиям
   https://640dcace-fc1d-4f73-95b6-e196d98eec59-00-6y6u6ng03tqr.worf.replit.dev
   https://via.placeholder.com/640x360.png?text=Interview+Prep
   ```

### 2. Важные настройки для получения данных пользователя

**В @BotFather выполните:**
```
/setdomain
@interview_prep_bot
640dcace-fc1d-4f73-95b6-e196d98eec59-00-6y6u6ng03tqr.worf.replit.dev
```

**Затем настройте меню:**
```
/setmenubutton
@interview_prep_bot
Открыть приложение
https://640dcace-fc1d-4f73-95b6-e196d98eec59-00-6y6u6ng03tqr.worf.replit.dev
```

### 3. Критически важно: Доступ через правильный URL

**Пользователи должны открывать Mini App через:**
- Кнопку в меню бота (установленную выше)
- Команду `/start` с инлайн-кнопкой
- НЕ через прямую ссылку в браузере

### 4. Проверка работы

После правильной настройки в консоли браузера должно появиться:
```javascript
// Вместо пустого объекта:
initDataUnsafe: {}

// Должны появиться реальные данные:
initDataUnsafe: {
  user: {
    id: 123456789,
    first_name: "Иван",
    last_name: "Иванов",
    username: "ivan_user",
    language_code: "ru"
  }
}
```

### 5. Для тестирования в разработке

Если данные все еще не приходят, приложение создает демо-пользователя с именем "Telegram Пользователь".

## Обновление 16.07.2025: Валидация данных

✅ Добавлена функция `validate_telegram_init_data()` для проверки подлинности данных  
✅ Frontend передает `initData` для валидации на сервере  
✅ При отсутствии валидного токена создается демо-пользователь  
✅ В логах показывается статус валидации (VALID/INVALID/DEMO)  

### Настройка токена бота (опционально)

1. Добавьте токен в `config.yaml`:
   ```yaml
   telegram:
     bot_token: "YOUR_BOT_TOKEN_HERE"
   ```

2. При правильной настройке в логах будет: `Telegram data validation: VALID`
3. Без токена будет создаваться демо-пользователь для тестирования

## Текущий статус

✅ Frontend готов для получения данных Telegram  
✅ Обработка авторизации реализована с валидацией  
✅ Система работает в тестовом режиме без токена  
⚠️ Для продакшена требуется настройка бота в @BotFather  
⚠️ Пользователи должны заходить через бота, а не по прямой ссылке  

## Для продакшена

1. Зарегистрируйте домен
2. Настройте HTTPS
3. Обновите URL в настройках бота
4. Добавьте валидацию `initData` на бэкенде для безопасности